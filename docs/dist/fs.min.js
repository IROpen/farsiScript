(function(){function t(e,r,n){function s(u,i){if(!r[u]){if(!e[u]){var a="function"==typeof require&&require;if(!i&&a)return a(u,!0);if(o)return o(u,!0);var l=new Error("Cannot find module '"+u+"'");throw l.code="MODULE_NOT_FOUND",l}var h=r[u]={exports:{}};e[u][0].call(h.exports,function(t){var r=e[u][1][t];return s(r||t)},h,h.exports,t,e,r,n)}return r[u].exports}for(var o="function"==typeof require&&require,u=0;u<n.length;u++)s(n[u]);return s}return t})()({1:[function(t,e,r){FS=t('../index.js')},{"../index.js":5}],2:[function(t,e,r){var n=function(){function t(t){this.lhsToRhsList={};for(var e in t){var r=t[e].split("->"),n=r[0].trim(),r=r[1].trim().split("|");this.lhsToRhsList[n]||(this.lhsToRhsList[n]=[]);for(var s in r)this.lhsToRhsList[n].push(r[s].trim().split(" "))}}function e(t){this.idToState={};this.currentId=0;this.chart=[];for(var e=0;e<t.length+1;e++)this.chart[e]=[]}function r(t,e,r,n,s){this.lhs=t;this.rhs=e;this.dot=r;this.left=n;this.right=s;this.id=-1;this.ref=[];for(t=0;t<e.length;t++)this.ref[t]={}}function n(t,e,r,s){if(e==t.length)s.push(r.slice());else if(0==t[e].length)n(t,e+1,r,s);else for(var o in t[e])(0==r.length||r[r.length-1].right==t[e][o].left)&&(r.push(t[e][o]),n(t,e+1,r,s),r.pop())}t.prototype.terminalSymbols=function(t){return[]};t.prototype.getRightHandSides=function(t){return(t=this.lhsToRhsList[t])?t:null};t.prototype.isEpsilonProduction=function(t){return"_EPSILON_"==t};loggingOn=0;e.prototype.addToChart=function(t,e){t.setId(this.currentId);var r=this.chart[e],n;for(n in r){var s=r[n];if(t.equals(s))return r=!1,r=s.appendRefsToChidStates(t.getRefsToChidStates())}r.push(t);this.idToState[this.currentId]=t;this.currentId++;return!0};e.prototype.getStatesInColumn=function(t){return this.chart[t]};e.prototype.countStatesInColumn=function(t){return this.chart[t].length};e.prototype.getState=function(t){return this.idToState[t]};e.prototype.getFinishedRoot=function(t){var e=this.chart[this.chart.length-1],r;for(r in e){var n=e[r];if(n.complete()&&n.getLeftHandSide()==t)return n}return null};e.prototype.log=function(t){if(loggingOn){console.log("-------------------");console.log("Column: "+t);console.log("-------------------");for(var e in this.chart[t])console.log(this.chart[t][e].toString())}};r.prototype.complete=function(){return this.dot>=this.rhs.length};r.prototype.toString=function(){var t=[];t.push("(id: "+this.id+")");t.push(this.lhs);t.push("\u2192");for(var e=0;e<this.rhs.length;e++)e==this.dot&&t.push("\u2022"),t.push(this.rhs[e]);this.complete()&&t.push("\u2022");t.push("["+this.left+", "+this.right+"]");t.push(JSON.stringify(this.ref));return t.join(" ")};r.prototype.expectedNonTerminal=function(t){return null!==t.getRightHandSides(this.rhs[this.dot])?!0:!1};r.prototype.setId=function(t){this.id=t};r.prototype.getId=function(){return this.id};r.prototype.equals=function(t){return this.lhs===t.lhs&&this.dot===t.dot&&this.left===t.left&&this.right===t.right&&JSON.stringify(this.rhs)===JSON.stringify(t.rhs)?!0:!1};r.prototype.getRefsToChidStates=function(){return this.ref};r.prototype.appendRefsToChidStates=function(t){for(var e=!1,r=0;r<t.length;r++)if(t[r])for(var n in t[r])this.ref[r][n]!=t[r][n]&&(e=!0),this.ref[r][n]=t[r][n];return e};r.prototype.predictor=function(t,e){var n=this.rhs[this.dot],s=t.getRightHandSides(n),o=!1,u;for(u in s){for(var i=s[u],a=0;i&&a<i.length&&t.isEpsilonProduction(i[a]);)a++;i=new r(n,i,a,this.right,this.right);o|=e.addToChart(i,this.right)}return o};r.prototype.scanner=function(t,e,n){var s=this.rhs[this.dot],o=!1;(t=n?t.terminalSymbols(n):[])||(t=[]);t.push(n);for(var u in t)if(s==t[u]){n=new r(s,[n],1,this.right,this.right+1);o|=e.addToChart(n,this.right+1);break};return o};r.prototype.completer=function(t,e){var n=!1,s=e.getStatesInColumn(this.left),o;for(o in s){var u=s[o];if(u.rhs[u.dot]==this.lhs){for(var i=u.dot+1;u.rhs&&i<u.rhs.length&&t.isEpsilonProduction(u.rhs[i]);)i++;i=new r(u.lhs,u.rhs,i,u.left,this.right);i.appendRefsToChidStates(u.ref);var a=Array(u.rhs.length);a[u.dot]={};a[u.dot][this.id]=this;i.appendRefsToChidStates(a);n|=e.addToChart(i,this.right)}}return n};r.prototype.traverse=function(){if(1==this.ref.length&&0==Object.keys(this.ref[0]).length){var t=[];this.lhs!=this.rhs&&t.push({root:this.rhs,left:this.left,right:this.right});return[{root:this.lhs,left:this.left,right:this.right,subtrees:t}]}for(var e=[],t=0;t<this.ref.length;t++){e[t]=[];for(var r in this.ref[t])e[t]=e[t].concat(this.ref[t][r].traverse())}r=[];n(e,0,[],r);e=[];for(t in r)e.push({root:this.lhs,left:this.left,right:this.right,subtrees:r[t]});return e};r.prototype.getLeftHandSide=function(){return this.lhs};var s={};s.Grammar=t;s.State=r;s.Chart=e;s.parse=function(t,n,s){var o=new e(t),u=n.getRightHandSides(s),i;for(i in u){var a=new r(s,u[i],0,0,0);o.addToChart(a,0)}for(i=0;i<t.length+1;i++){for(s=!0;s;)for(s=!1,j=0;j<o.countStatesInColumn(i);)u=o.getStatesInColumn(i)[j],s=u.complete()?s|u.completer(n,o):u.expectedNonTerminal(n)?s|u.predictor(n,o):s|u.scanner(n,o,t[i]),j++;o.log(i)}return o};s.logging=function(t){loggingOn=t};return s}();e.exports=n},{}],3:[function(t,e,r){let n=t('./earley-parser.js');wordlist=new Map([['است','ast'],['.','noghte'],['?','alamat_soal'],['(','parantez_baz'],[')','parantez_baste'],['،','virgool'],['؟','alamat_soal'],['چیست','chist'],['نوعی','noyi'],['در','harfe_ezafe'],['با','harfe_ezafe'],['هر','har'],['کن','kon'],['را','ra'],['سپس','sepas'],['یعنی','yani']]);fsg=new n.Grammar(['root -> assign noghte | func_assign noghte | ask alamat_soal | cmd noghte | cmd_assign noghte','cmd_root -> cmd','cmd -> cmd_tak | cmd_tak sepas cmd','cmd_tak -> eval_task ra esm kon | eval_task ra eval_motam_list esm kon | eval_motam_list esm kon | esm kon','assign -> esm eval_task ast | esm virgool eval_task ast','func_assign -> esm input virgool eval_task ast | esm input eval_motam_list virgool eval_task ast','input -> eval_task | har esm','eval_task -> noyi esm | parantez_baz eval_task parantez_baste | num | esm | obj | esm eval_task | esm eval_task eval_motam_list','eval_motam_list -> eval_motam_list eval_motamam | eval_motamam','eval_motamam -> harfe_ezafe eval_task','ask -> eval_task chist','cmd_assign -> esm kon yani cmd']);fsg.terminalSymbols=function(t){if(wordlist.has(t)){let e=wordlist.get(t);if(typeof e=='string')return[e];else return e}if(t.match(/^\d+$/))return['num'];if(t[0]=='"'||t[0]=='{'||t[0]=='[')return['obj'];return['esm']};function s(t){return t.replace(/[٠١٢٣٤٥٦٧٨٩]/g,function(t){return t.charCodeAt(0)-1632}).replace(/[۰۱۲۳۴۵۶۷۸۹]/g,function(t){return t.charCodeAt(0)-1776})}function o(t){var e=0,r=0;t=t.replace(t=>t=='\n'?' ':t).split('');for(let n=0;n<t.length;n++){let s=t[n];s=='"'&&(e^=1);(s=='{'||s=='[')&&r++;(s=='}'||s==']')&&r--;s==' '&&r==0&&e==0&&(t[n]='\n')}return t.join('').split('\n').filter(Boolean)}function u(t,e = 'root'){t=o(s(t));let r=n.parse(t,fsg,e),u=r.getFinishedRoot(e).traverse();return u}e.exports=u},{"./earley-parser.js":2}],4:[function(t,e,r){FSI={defs:{varf:t=>t,funcf:(t,e,r)=>t+' '+e},varlist:new Map([]),funclist:new Map([['منها-منها',[function(t,e){return t-1 }]],['جمع',[function(t,e){return t+e[0].value }]],['ضرب',[function(t,e){return t*e[0].value }]]]),typelist:new Map([['چیز',{par:'چیز',members:[]}],['میوه',{par:'چیز',members:[]}],['انسان',{par:'چیز',members:[]}]]),tasklist:new Map([['صبر',async function(t,e){let r=function(t){return new Promise(e=>{setTimeout(e,t)})};await r(t)}]]),ClassicType:function(t,e){this.id=t;this.type=e;this.toString=()=>this.type+'('+this.id+')'},matchMotamam:function(t,e){if(t.length!=e.length)return!1;for(let r=t.length-1;r>=0;r--){if('value' in t[r]&&'value' in e[r]&&e[r].value!=t[r].value){return!1}}return!0},evlMotamamList:async function(t){if(t.subtrees.length==1){let e=t.subtrees[0];return[{harfeEzafe:e.subtrees[0].subtrees[0].root[0],value:await FSI.evl(e.subtrees[1])}]}},runFunc:async function(t,e,r){r==void 0&&(r=[]);let n=FSI.funclist.get(t);if(n==void 0)return await FSI.defs.funcf(t,e,r);for(let t=n.length-1;t>=0;t--){let s=await n[t](e,r);if(s!=void 0)return s}return await FSI.defs.funcf(t,e,r)},evl:async function t(e){if(e.root=='I')return e.I;if(e.subtrees[0].root=='parantez_baz'){return await t(e.subtrees[1])}if(e.subtrees[0].root=='noyi'){let t=e.subtrees[1].subtrees[0].root[0];if(!FSI.typelist.has(t)){return void 0}let r=FSI.typelist.get(t),n=new FSI.ClassicType(r.members.length,t);r.members.push(n);return n}if(e.subtrees.length==1){let t=e.subtrees[0];if(t.root=='obj'){return JSON.parse(t.subtrees[0].root[0])}if(t.root=='num'){return Number(t.subtrees[0].root)}if(t.root=='esm'){if(FSI.varlist.has(t.subtrees[0].root[0])){return FSI.varlist.get(t.subtrees[0].root[0])}else{return FSI.defs.varf(t.subtrees[0].root[0])}}}if(e.subtrees.length==2){let r=e.subtrees[0];if(r.root=='esm'){let n=await t(e.subtrees[1]),s=r.subtrees[0].root[0];return FSI.runFunc(s,n)}}if(e.subtrees.length==3){let r=e.subtrees[0];if(r.root=='esm'){let n=await t(e.subtrees[1]),s=await FSI.evlMotamamList(e.subtrees[2]),o=r.subtrees[0].root[0];return FSI.runFunc(o,n,s)}}},evl_with_dic:async function(t,e){let r=[];e.forEach((t,e)=>{FSI.varlist.has(e)&&r.push([e,FSI.varlist.get(e)])});e.forEach((t,e)=>FSI.varlist.set(e,t));let n=await FSI.evl(t);e.forEach((t,e)=>FSI.varlist.delete(e));r.forEach(t=>FSI.varlist.set(t[0],t[1]));return n},treeToText:function t(e){if(!e.subtrees||e.subtrees.length==0){return e.root}return e.subtrees.map(t).join(' ')},evlCmdTak:async function(t){if(t.subtrees.length==2){let e=t.subtrees[0].subtrees[0].root[0],r=FSI.tasklist.get(e);await r(void 0,[]);return}if(t.subtrees.length==3){let e=await FSI.evlMotamamList(t.subtrees[0]),r=t.subtrees[1].subtrees[0].root[0],n=FSI.tasklist.get(r);await n(void 0,e);return}if(t.subtrees.length==4){let e=await FSI.evl(t.subtrees[0]),r=t.subtrees[2].subtrees[0].root[0],n=FSI.tasklist.get(r);await n(e,[]);return}if(t.subtrees.length==5){let e=await FSI.evl(t.subtrees[0]),r=await FSI.evlMotamamList(t.subtrees[2]),n=t.subtrees[3].subtrees[0].root[0],s=FSI.tasklist.get(n);await s(e,r);return}},evlCmd:async function(t){if(t.subtrees.length==1){return await FSI.evlCmdTak(t.subtrees[0])}if(t.subtrees.length==3){await FSI.evlCmdTak(t.subtrees[0]);return await FSI.evlCmd(t.subtrees[2])}},run:async function(t){let e=t.subtrees[0];if(e.root=='cmd'){FSI.evlCmd(e);return"در حال انجام است ."}if(e.root=='ask'){let t=await FSI.evl(e.subtrees[0]);return FSI.treeToText(e.subtrees[0])+" ، "+t+" است ."}if(e.root=='assign'){let t=e.subtrees.find(t=>t.root=="esm").subtrees[0].root[0],r=await FSI.evl(e.subtrees.find(t=>t.root=="eval_task"));FSI.varlist.set(t,r);return"فهمیدم ."}if(e.root=='cmd_assign'){if(e.subtrees.length==4){let t=e.subtrees[0].subtrees[0].root[0];FSI.tasklist.set(t,async()=>(await FSI.evlCmd(e.subtrees[3])))}}if(e.root=='func_assign'){let t=e.subtrees[0].subtrees[0].root[0];FSI.funclist.has(t)||FSI.funclist.set(t,[]);let r=e.subtrees[1].subtrees[0],n=[],s=e.subtrees[e.subtrees.length-2];s.subtrees[0].root=='noyi'&&(s={root:"I",I:FSI.evl(s)});e.subtrees[2].root!='virgool'&&(n=FSI.evlMotamamList(e.subtrees[2]));if(r.root=='eval_task'){let e=await FSI.evl(r);FSI.funclist.get(t).push(async function(t,r){if(t==e&&FSI.matchMotamam(r,n)){return await FSI.evl(s)}return void 0});return"فهمیدم ."}if(r.root=='har'){FSI.funclist.get(t).push(async function(t,e){if(FSI.matchMotamam(e,n)){return await FSI.evl_with_dic(s,new Map([["او",t]]))}return void 0});return"فهمیدم ."}}}};e.exports=FSI},{}],5:[function(t,e,r){let n=t('./fsinterpreter'),s=t('./fsgrammar');n.tasklist.set('اجرا',async function(t,e){try{let o=s(t,'cmd_root')[0].subtrees[0];if(e.length==0){return await n.evlCmd(o)}if(e[0].harfeEzafe=='با'){var r=e[0].value;while(r--)await n.evlCmd(o)}}catch(t){return}});e.exports={eval:async t=>{try{let e=s(t)[0];return await n.run(e)}catch(t){return"متوجه نشدم ."}},FSI:n,fparse:s}},{"./fsgrammar":3,"./fsinterpreter":4}]},{},[1])